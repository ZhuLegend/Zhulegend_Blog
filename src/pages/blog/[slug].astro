---
import BlogPostMeta from "../../components/BlogPostMeta.astro";
import ContentLayout from "../../layouts/ContentLayout.astro";
import { SITE_URL } from "../../config";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection("blog",
      ({data}) => !data.draft && !data.external);

  return posts.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { slug} = Astro.params;
const { entry } = Astro.props;

const frontmatter = entry.data;
const { Content } = await entry.render();

const ogImageAbsoluteUrl =
  frontmatter.external !== true && frontmatter.ogImagePath
    ? new URL(frontmatter.ogImagePath, SITE_URL).toString()
    : undefined;
---

<ContentLayout title={frontmatter.title} date={frontmatter.date}>
  <BlogPostMeta
    title={frontmatter.title}
    description={frontmatter.external ? undefined : frontmatter.description}
    publishDate={frontmatter.date.toISOString()}
    pagePath={`/blog/${slug}`}
    ogImageAbsoluteUrl={ogImageAbsoluteUrl}
    slot="meta"
  />
  <Content slot="content"/>
</ContentLayout>
